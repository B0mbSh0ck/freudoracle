"""
–ö–∏—Ç–∞–π—Å–∫–∞—è –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—è –°—é—Ü–∞–π (Suanming / Chinese Numerology)
–†–∞—Å—á–µ—Ç —á–∏—Å–ª–∞ —Å—É–¥—å–±—ã, –ª–∏—á–Ω–æ—Å—Ç–∏ –∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏ –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è
"""
from datetime import datetime
from dataclasses import dataclass
from typing import Dict, List


@dataclass
class SucaiNumbers:
    """–ß–∏—Å–ª–∞ –°—é—Ü–∞–π"""
    life_path: int  # –ß–∏—Å–ª–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏
    destiny: int  # –ß–∏—Å–ª–æ —Å—É–¥—å–±—ã
    soul: int  # –ß–∏—Å–ª–æ –¥—É—à–∏
    personality: int  # –ß–∏—Å–ª–æ –ª–∏—á–Ω–æ—Å—Ç–∏
    maturity: int  # –ß–∏—Å–ª–æ –∑—Ä–µ–ª–æ—Å—Ç–∏
    
    # –ö–∏—Ç–∞–π—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    element: str  # Wood, Fire, Earth, Metal, Water
    yin_yang: str  # Yin –∏–ª–∏ Yang
    
    # –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
    life_path_meaning: str
    destiny_meaning: str
    soul_meaning: str
    personality_meaning: str
    
    # –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
    lucky_numbers: List[int]
    unlucky_numbers: List[int]
    lucky_colors: List[str]
    lucky_directions: List[str]


class ChineseNumerology:
    """–ö–∏—Ç–∞–π—Å–∫–∞—è –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—è –°—é—Ü–∞–π"""
    
    # –ó–Ω–∞—á–µ–Ω–∏—è —á–∏—Å–µ–ª (1-9)
    LIFE_PATH_MEANINGS = {
        1: "–õ–∏–¥–µ—Ä –∏ –ø–µ—Ä–≤–æ–ø—Ä–æ—Ö–æ–¥–µ—Ü. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏, –∞–º–±–∏—Ü–∏–∏. –ü—Ä–∏—Ä–æ–∂–¥–µ–Ω–Ω—ã–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å.",
        2: "–ú–∏—Ä–æ—Ç–≤–æ—Ä–µ—Ü –∏ –¥–∏–ø–ª–æ–º–∞—Ç. –°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∏–Ω—Ç—É–∏—Ü–∏—è. –†–∞–±–æ—Ç–∞ –≤ –∫–æ–º–∞–Ω–¥–µ.",
        3: "–¢–≤–æ—Ä–µ—Ü –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä. –°–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –æ–ø—Ç–∏–º–∏–∑–º, –∞—Ä—Ç–∏—Å—Ç–∏–∑–º. –†–∞–¥–æ—Å—Ç—å –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å.",
        4: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫.",
        5: "–ò—Å–∫–∞—Ç–µ–ª—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π. –°–≤–æ–±–æ–¥–∞, –ø–µ—Ä–µ–º–µ–Ω—ã, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å. –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ–ø—ã—Ç.",
        6: "–í–æ—Å–ø–∏—Ç–∞—Ç–µ–ª—å –∏ —Ü–µ–ª–∏—Ç–µ–ª—å. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞–±–æ—Ç–∞, –≥–∞—Ä–º–æ–Ω–∏—è. –°–µ–º—å—è –∏ —Å–ª—É–∂–µ–Ω–∏–µ.",
        7: "–ú—ã—Å–ª–∏—Ç–µ–ª—å –∏ –º–∏—Å—Ç–∏–∫. –ê–Ω–∞–ª–∏–∑, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å, –º—É–¥—Ä–æ—Å—Ç—å. –ü–æ–∏—Å–∫ –∏—Å—Ç–∏–Ω—ã.",
        8: "–ú–∞–≥–Ω–∞—Ç –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç–µ–ª—å. –í–ª–∞—Å—Ç—å, –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π —É—Å–ø–µ—Ö, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç. –ü—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏–µ.",
        9: "–ì—É–º–∞–Ω–∏—Å—Ç –∏ —É—á–∏—Ç–µ–ª—å. –°–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –∏–¥–µ–∞–ª–∏–∑–º, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ. –°–ª—É–∂–µ–Ω–∏–µ –º–∏—Ä—É."
    }
    
    DESTINY_MEANINGS = {
        1: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - –±—ã—Ç—å –ø–µ—Ä–≤—ã–º, –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å, –≤–µ—Å—Ç–∏ –∑–∞ —Å–æ–±–æ–π.",
        2: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ª—é–¥–µ–π, —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—é –∏ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–∞.",
        3: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö —á–µ—Ä–µ–∑ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∏ —Ä–∞–¥–æ—Å—Ç—å.",
        4: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—á–Ω—ã–µ –æ—Å–Ω–æ–≤—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.",
        5: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –º–∏—Ä –∏ –Ω–µ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω—ã.",
        6: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - –∑–∞–±–æ—Ç–∏—Ç—å—Å—è, –∏—Å—Ü–µ–ª—è—Ç—å –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—é.",
        7: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - –ø–æ–∑–Ω–∞–≤–∞—Ç—å —Ç–∞–π–Ω—ã –∏ –¥–µ–ª–∏—Ç—å—Å—è –º—É–¥—Ä–æ—Å—Ç—å—é.",
        8: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - –¥–æ—Å—Ç–∏–≥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ —É—Å–ø–µ—Ö–∞ –∏ –ø—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏—è.",
        9: "–í–∞—à–∞ —Å—É–¥—å–±–∞ - —Å–ª—É–∂–∏—Ç—å —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤—É –∏ –∑–∞–≤–µ—Ä—à–∞—Ç—å —Ü–∏–∫–ª—ã."
    }
    
    # –ö–∏—Ç–∞–π—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    ELEMENTS = {
        1: ('–í–æ–¥–∞', ['—Å–∏–Ω–∏–π', '—á–µ—Ä–Ω—ã–π'], ['–°–µ–≤–µ—Ä']),
        2: ('–ó–µ–º–ª—è', ['–∂–µ–ª—Ç—ã–π', '–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π'], ['–¶–µ–Ω—Ç—Ä']),
        3: ('–î–µ—Ä–µ–≤–æ', ['–∑–µ–ª–µ–Ω—ã–π'], ['–í–æ—Å—Ç–æ–∫']),
        4: ('–î–µ—Ä–µ–≤–æ', ['–∑–µ–ª–µ–Ω—ã–π'], ['–Æ–≥–æ-–í–æ—Å—Ç–æ–∫']),
        5: ('–ó–µ–º–ª—è', ['–∂–µ–ª—Ç—ã–π', '–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π'], ['–¶–µ–Ω—Ç—Ä']),
        6: ('–ú–µ—Ç–∞–ª–ª', ['–±–µ–ª—ã–π', '–∑–æ–ª–æ—Ç–æ–π'], ['–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥']),
        7: ('–ú–µ—Ç–∞–ª–ª', ['–±–µ–ª—ã–π', '—Å–µ—Ä–µ–±—Ä—è–Ω—ã–π'], ['–ó–∞–ø–∞–¥']),
        8: ('–ó–µ–º–ª—è', ['–∂–µ–ª—Ç—ã–π', '–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π'], ['–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ–∫']),
        9: ('–û–≥–æ–Ω—å', ['–∫—Ä–∞—Å–Ω—ã–π', '–æ—Ä–∞–Ω–∂–µ–≤—ã–π'], ['–Æ–≥'])
    }
    
    def calculate_sucai(self, birth_date: datetime, full_name: str = "") -> SucaiNumbers:
        """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —á–∏—Å–ª–∞ –°—é—Ü–∞–π"""
        
        # 1. –ß–∏—Å–ª–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏ (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)
        life_path = self._calculate_life_path(birth_date)
        
        # 2. –ß–∏—Å–ª–æ —Å—É–¥—å–±—ã (–∏–∑ –ø–æ–ª–Ω–æ–π –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è)
        destiny = self._calculate_destiny(birth_date)
        
        # 3. –ß–∏—Å–ª–æ –¥—É—à–∏ (–∏–∑ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è)
        soul = self._reduce_to_single(birth_date.day)
        
        # 4. –ß–∏—Å–ª–æ –ª–∏—á–Ω–æ—Å—Ç–∏ (–∏–∑ –º–µ—Å—è—Ü–∞)
        personality = self._reduce_to_single(birth_date.month)
        
        # 5. –ß–∏—Å–ª–æ –∑—Ä–µ–ª–æ—Å—Ç–∏ (–∂–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—É—Ç—å + —Å—É–¥—å–±–∞)
        maturity = self._reduce_to_single(life_path + destiny)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏ –ò–Ω—å/–Ø–Ω
        element_name, colors, directions = self.ELEMENTS.get(life_path, ('–ó–µ–º–ª—è', ['–∂–µ–ª—Ç—ã–π'], ['–¶–µ–Ω—Ç—Ä']))
        
        # –ò–Ω—å –∏–ª–∏ –Ø–Ω (—á–µ—Ç–Ω—ã–µ - –ò–Ω—å, –Ω–µ—á–µ—Ç–Ω—ã–µ - –Ø–Ω)
        yin_yang = "–ò–Ω—å (‚ôÄ)" if life_path % 2 == 0 else "–Ø–Ω (‚ôÇ)"
        
        # –°—á–∞—Å—Ç–ª–∏–≤—ã–µ –∏ –Ω–µ—Å—á–∞—Å—Ç–ª–∏–≤—ã–µ —á–∏—Å–ª–∞
        lucky_numbers = self._get_lucky_numbers(life_path)
        unlucky_numbers = self._get_unlucky_numbers(life_path)
        
        return SucaiNumbers(
            life_path=life_path,
            destiny=destiny,
            soul=soul,
            personality=personality,
            maturity=maturity,
            element=element_name,
            yin_yang=yin_yang,
            life_path_meaning=self.LIFE_PATH_MEANINGS.get(life_path, ""),
            destiny_meaning=self.DESTINY_MEANINGS.get(destiny, ""),
            soul_meaning=self.LIFE_PATH_MEANINGS.get(soul, ""),
            personality_meaning=self.LIFE_PATH_MEANINGS.get(personality, ""),
            lucky_numbers=lucky_numbers,
            unlucky_numbers=unlucky_numbers,
            lucky_colors=colors,
            lucky_directions=directions
        )
    
    def _calculate_life_path(self, birth_date: datetime) -> int:
        """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —á–∏—Å–ª–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏"""
        # –°–∫–ª–∞–¥—ã–≤–∞–µ–º –≤—Å–µ —Ü–∏—Ñ—Ä—ã –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è
        day = birth_date.day
        month = birth_date.month
        year = birth_date.year
        
        # –ú–µ—Ç–æ–¥ 1: –°–∫–ª–∞–¥—ã–≤–∞–µ–º –¥–µ–Ω—å, –º–µ—Å—è—Ü, –≥–æ–¥ –æ—Ç–¥–µ–ª—å–Ω–æ, –∑–∞—Ç–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        day_sum = self._reduce_to_single(day)
        month_sum = self._reduce_to_single(month)
        year_sum = self._reduce_to_single(year)
        
        total = day_sum + month_sum + year_sum
        return self._reduce_to_single(total)
    
    def _calculate_destiny(self, birth_date: datetime) -> int:
        """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —á–∏—Å–ª–æ —Å—É–¥—å–±—ã"""
        # –°–∫–ª–∞–¥—ã–≤–∞–µ–º –≤—Å–µ —Ü–∏—Ñ—Ä—ã –¥–∞—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é
        date_string = birth_date.strftime('%d%m%Y')
        total = sum(int(digit) for digit in date_string)
        return self._reduce_to_single(total)
    
    def _reduce_to_single(self, number: int) -> int:
        """–°–≤–µ—Å—Ç–∏ —á–∏—Å–ª–æ –∫ –æ–¥–Ω–æ–π —Ü–∏—Ñ—Ä–µ (1-9)"""
        while number > 9:
            number = sum(int(digit) for digit in str(number))
        return number if number > 0 else 9
    
    def _get_lucky_numbers(self, life_path: int) -> List[int]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å—á–∞—Å—Ç–ª–∏–≤—ã–µ —á–∏—Å–ª–∞"""
        lucky_map = {
            1: [1, 5, 7],
            2: [2, 6, 9],
            3: [3, 6, 9],
            4: [4, 8],
            5: [5, 1, 7],
            6: [6, 2, 3],
            7: [7, 1, 5],
            8: [8, 4],
            9: [9, 2, 3, 6]
        }
        return lucky_map.get(life_path, [life_path])
    
    def _get_unlucky_numbers(self, life_path: int) -> List[int]:
        """–ü–æ–ª—É—á–∏—Ç—å –Ω–µ—Å—á–∞—Å—Ç–ª–∏–≤—ã–µ —á–∏—Å–ª–∞"""
        # –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        unlucky_map = {
            1: [4, 8],  # –í–æ–¥–∞ vs –î–µ—Ä–µ–≤–æ
            2: [5],
            3: [7],
            4: [1, 5],
            5: [2],
            6: [9],
            7: [3],
            8: [1, 5],
            9: [6]
        }
        return unlucky_map.get(life_path, [])
    
    def format_sucai(self, sucai: SucaiNumbers) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∏—Å–ª–∞ –°—é—Ü–∞–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
        result = f"""
üî¢ **–ö–ò–¢–ê–ô–°–ö–ê–Ø –ù–£–ú–ï–†–û–õ–û–ì–ò–Ø –°–Æ–¶–ê–ô**

**üéØ –í–ê–®–ò –ß–ò–°–õ–ê:**
‚Ä¢ –ß–∏—Å–ª–æ –ñ–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ü—É—Ç–∏: **{sucai.life_path}**
  {sucai.life_path_meaning}

‚Ä¢ –ß–∏—Å–ª–æ –°—É–¥—å–±—ã: **{sucai.destiny}**
  {sucai.destiny_meaning}

‚Ä¢ –ß–∏—Å–ª–æ –î—É—à–∏: **{sucai.soul}**
  –í–∞—à –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä –∏ –∂–µ–ª–∞–Ω–∏—è

‚Ä¢ –ß–∏—Å–ª–æ –õ–∏—á–Ω–æ—Å—Ç–∏: **{sucai.personality}**
  –ö–∞–∫ –≤–∞—Å –≤–∏–¥—è—Ç –¥—Ä—É–≥–∏–µ

‚Ä¢ –ß–∏—Å–ª–æ –ó—Ä–µ–ª–æ—Å—Ç–∏: **{sucai.maturity}**
  –í–∞—à –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –≤–æ –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–µ –∂–∏–∑–Ω–∏

**üåü –ö–ò–¢–ê–ô–°–ö–ê–Ø –ú–ï–¢–ê–§–ò–ó–ò–ö–ê:**
‚Ä¢ –≠–ª–µ–º–µ–Ω—Ç: **{sucai.element}**
‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: **{sucai.yin_yang}**

**üçÄ –í–ê–®–ò –°–ß–ê–°–¢–õ–ò–í–´–ï –°–ò–ú–í–û–õ–´:**
‚Ä¢ –ß–∏—Å–ª–∞: {', '.join(map(str, sucai.lucky_numbers))}
‚Ä¢ –¶–≤–µ—Ç–∞: {', '.join(sucai.lucky_colors)}
‚Ä¢ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: {', '.join(sucai.lucky_directions)}

**‚ö†Ô∏è –ò–∑–±–µ–≥–∞–π—Ç–µ —á–∏—Å–µ–ª:** {', '.join(map(str, sucai.unlucky_numbers))}
"""
        return result.strip()


# Singleton
chinese_numerology = ChineseNumerology()
